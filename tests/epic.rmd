Retrieve the dataset IDAT files from GEO:
```
wget ftp://ftp.ncbi.nlm.nih.gov/geo/series/GSE51nnn/GSE51032/suppl/GSE51032_RAW.tar
tar xvf GSE51032_RAW.tar
gunzip *.gz
```

Possibly related to following studies:

> Demetriou, et al.
> Methylome analysis and epigenetic changes associated with menarcheal age.
> PLoS One. 2013 Nov 20;8(11):e79391. doi: 10.1371/journal.pone.0079391. eCollection 2013.
> PMID: 24278132 

> Stringhini, et al.
> Life-course socioeconomic status and DNA methylation of genes regulating inflammation.
> Int J Epidemiol. 2015 Apr 17. pii: dyv060. [Epub ahead of print]
> PMID: 25889032

Set `path` to be the location of the IDAT files for the dataset.
```{r}
path <- "~/work/data/GSE51032-epic"
```

```{r}
library(meffil)
options(mc.cores=10)
samplesheet <- meffil.create.samplesheet(path)
```

```{r}
step1.time <- system.time(qc.objects <- meffil.qc(samplesheet))
step1.mem <- gc(reset=TRUE)
step2.time <- system.time(norm.objects <- meffil.normalize.quantiles(norm.objects, number.pcs=2))
step2.mem <- gc(reset=TRUE)
step3.time <- system.time(beta <- meffil.normalize.samples(norm.objects, beta=T))
step3.mem <- gc(reset=TRUE)
```
Takes about 1 hour.

```{r}
step1.time
step2.time
step3.time
```

```{r}
step1.mem
step2.mem
step3.mem
```

```{r}
print(object.size(norm.objects), units="Mb")
print(object.size(beta), units="Mb")
```

```{r}
(print(length(norm.objects))
 * print(length(norm.objects[[1]]$quantiles))
 * print(length(norm.objects[[1]]$quantiles[[1]]))
 * print(length(norm.objects[[1]]$quantiles[[1]][[1]]))
 * print(.Machine$sizeof.long)
 / 2^20)
```

```{r}
min(beta,na.rm=T)
max(beta,na.rm=T)
sum(is.na(beta))
```



```{r, results='hide', message=F}
library(minfi, quietly=TRUE)
```

```{r, cache=TRUE}
raw.minfi <- read.450k.exp(base = path)
minfi.time <- system.time(norm.minfi <- preprocessFunnorm(raw.minfi, nPCs=2,
                                                          sex=NULL, bgCorr=TRUE, dyeCorr=TRUE,
                                                          verbose=TRUE))
beta.minfi <- getBeta(norm.minfi)
```

```{r}
minfi.time
```
Took about 4 hours but likely because memory use maximum.

```{r}
rm(norm.minfi)
gc(reset=TRUE)
```


```{r}
quantile(beta.minfi[rownames(beta),] - beta, na.rm=T)
```


This file was generated from R markdown:

```{r, eval=F}
library(knitr)
knit("epic.rmd")
library(markdown)
markdownToHTML("epic.md","epic.html")
```
