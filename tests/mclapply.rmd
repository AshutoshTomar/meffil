
```{r}
source("get-dataset.r")
```

```{r}
library(meffil)
basenames <- meffil.basenames(path)
options(mc.cores=8)
B.1 <- meffil.normalize.dataset(filenames=basenames, number.pcs=5, verbose=T)
```

```{r}
norm.objects <- mclapply(basenames, meffil.compute.normalization.object, verbose=T)
norm.objects <- meffil.normalize.objects(norm.objects, number.pcs=5)
B.2 <- meffil.normalize.samples(norm.objects)
```

```{r}
quantile(B.1-B.2, na.rm=T)
```

Normalize using the minfi package.
```{r results='hide'}
library(minfi, quietly=TRUE)
source("preprocessFunnorm.R")
raw.minfi <- read.450k.exp(base = path)
system.time(norm.minfi <- preprocessFunnorm.debug(raw.minfi, nPCs=5,
                                            sex=NULL, bgCorr=TRUE, dyeCorr=TRUE, verbose=TRUE))
B.minfi <- getBeta(norm.minfi)
```

```{r}
probes <- meffil.probe.info()
autosomal.cgs <- unique(probes$name[which(probes$chr %in% paste("chr", 1:22, sep=""))])
quantile(B.minfi[autosomal.cgs,] - B.1[autosomal.cgs,], na.rm=T)
```
